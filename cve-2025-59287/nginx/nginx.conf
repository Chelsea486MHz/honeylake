server {
    listen 8530;
    server_name _;

    access_log /var/log/nginx/wsus_decoy_access.log combined;
    error_log /var/log/nginx/wsus_decoy_error.log warn;

    client_max_body_size 200M;

    add_header Server "Microsoft-IIS/10.0" always;
    add_header X-Powered-By "ASP.NET" always;

    location /ReportWebService/ReportWebService.asmx {
        proxy_set_header X-Decoy "HoneyLake-WSUS-Decoy";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Original-URI $request_uri;
        proxy_set_header Host $host;
        proxy_pass http://cve-2025-59287-backend:8081/ReportWebService/ReportWebService.asmx$is_args$args;
    }

    location /ClientWebService/Client.asmx {
        proxy_set_header X-Decoy "HoneyLake-WSUS-Decoy";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Original-URI $request_uri;
        proxy_set_header Host $host;
        proxy_pass http://cve-2025-59287-backend:8081/ClientWebService/Client.asmx$is_args$args;
    }

    location /ClientWebService/ClientWebService.asmx {
        proxy_set_header X-Decoy "HoneyLake-WSUS-Decoy";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Original-URI $request_uri;
        proxy_set_header Host $host;
        proxy_pass http://cve-2025-59287-backend:8081/ClientWebService/ClientWebService.asmx$is_args$args;
    }

    location /ApiRemoting30/WebService.asmx {
        proxy_set_header X-Decoy "HoneyLake-WSUS-Decoy";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Original-URI $request_uri;
        proxy_pass http://cve-2025-59287-backend:8081/ApiRemoting30/WebService.asmx$is_args$args;
    }

    location /SimpleAuthWebService/SimpleAuth.asmx {
        proxy_set_header X-Decoy "HoneyLake-WSUS-Decoy";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Original-URI $request_uri;
        proxy_pass http://cve-2025-59287-backend:8081/SimpleAuthWebService/SimpleAuth.asmx$is_args$args;
    }

    location / {
        proxy_set_header X-Real-IP $remote_addr;
        proxy_pass http://cve-2025-59287-backend:8081/;
    }
}

server {
    listen 8531 ssl;
    server_name _;

    ssl_certificate /etc/nginx/ssl/wsus-selfsigned.crt;
    ssl_certificate_key /etc/nginx/ssl/wsus-selfsigned.key;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers 'ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256';
    ssl_prefer_server_ciphers on;

    access_log /var/log/nginx/wsus_decoy_ssl_access.log combined;
    error_log /var/log/nginx/wsus_decoy_ssl_error.log warn;

    client_max_body_size 200M;

    add_header Server "Microsoft-IIS/10.0" always;
    add_header X-Powered-By "ASP.NET" always;

    location /ReportWebService/ReportWebService.asmx {
        proxy_set_header X-Decoy "HoneyLake-WSUS-Decoy";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Original-URI $request_uri;
        proxy_set_header Host $host;
        proxy_pass http://cve-2025-59287-backend:8081/ReportWebService/ReportWebService.asmx$is_args$args;
    }

    location /ClientWebService/Client.asmx {
        proxy_set_header X-Decoy "HoneyLake-WSUS-Decoy";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Original-URI $request_uri;
        proxy_set_header Host $host;
        proxy_pass http://cve-2025-59287-backend:8081/ClientWebService/Client.asmx$is_args$args;
    }

    location /ClientWebService/ClientWebService.asmx {
        proxy_set_header X-Decoy "HoneyLake-WSUS-Decoy";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Original-URI $request_uri;
        proxy_set_header Host $host;
        proxy_pass http://cve-2025-59287-backend:8081/ClientWebService/ClientWebService.asmx$is_args$args;
    }

    location /ApiRemoting30/WebService.asmx {
        proxy_set_header X-Decoy "HoneyLake-WSUS-Decoy";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Original-URI $request_uri;
        proxy_pass http://cve-2025-59287-backend:8081/ApiRemoting30/WebService.asmx$is_args$args;
    }

    location /SimpleAuthWebService/SimpleAuth.asmx {
        proxy_set_header X-Decoy "HoneyLake-WSUS-Decoy";
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Original-URI $request_uri;
        proxy_pass http://cve-2025-59287-backend:8081/SimpleAuthWebService/SimpleAuth.asmx$is_args$args;
    }

    location / {
        proxy_set_header X-Real-IP $remote_addr;
        proxy_pass http://cve-2025-59287-backend:8081/;
    }
}